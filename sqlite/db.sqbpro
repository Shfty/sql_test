<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="P:/Personal/Rust/Projects/sql_test/sqlite/db.sqlite" readonly="0" foreign_keys="0" case_sensitive_like="0" temp_store="2" wal_autocheckpoint="1000" synchronous="0"/><attached/><window><main_tabs open="structure browser query pragmas" current="2"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="1485"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,18:maincomponent_velocity"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="ball" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_ball" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_paddle" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_position" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_radius" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="57"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_score" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="53"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_size" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="53"/><column index="3" value="58"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="component_velocity" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="paddle" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="50"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="position" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="position_velocity" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/><column index="4" value="40"/><column index="5" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="radius" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="52"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="score" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="48"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="size" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="48"/><column index="3" value="53"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="temp" name="test_view" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/><column index="4" value="40"/><column index="5" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="test_view" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/><column index="4" value="40"/><column index="5" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="velocity" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="velocity_position" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/><column index="4" value="40"/><column index="5" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="view_ball_position" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="40"/><column index="2" value="40"/><column index="3" value="40"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="view_velocity_position" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths/><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="Schema">BEGIN TRANSACTION;
DROP TABLE IF EXISTS &quot;component_position&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_position&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	&quot;x&quot;	INTEGER NOT NULL,
	&quot;y&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_size&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_size&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	&quot;width&quot;	INTEGER NOT NULL,
	&quot;height&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_velocity&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_velocity&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	&quot;x&quot;	INTEGER NOT NULL,
	&quot;y&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_radius&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_radius&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	&quot;radius&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_ball&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_ball&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_paddle&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_paddle&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP TABLE IF EXISTS &quot;component_score&quot;;
CREATE TABLE IF NOT EXISTS &quot;component_score&quot; (
	&quot;id&quot;	INTEGER NOT NULL,
	&quot;score&quot;	INTEGER NOT NULL,
	PRIMARY KEY(&quot;id&quot;)
);
DROP VIEW IF EXISTS &quot;view_velocity_position&quot;;
CREATE VIEW &quot;view_velocity_position&quot; AS SELECT p.id, v.x AS vx, v.y AS vy, p.x AS px, p.y AS py FROM component_position AS p INNER JOIN component_velocity AS v ON p.id = v.id;
DROP VIEW IF EXISTS &quot;view_ball_position&quot;;
CREATE VIEW &quot;view_ball_position&quot; AS SELECT b.id, p.x, p.y FROM component_ball as b INNER JOIN component_position as p WHERE b.id = p.id;
COMMIT;
</sql><sql name="Data">BEGIN TRANSACTION;
INSERT INTO component_position (id, x, y) VALUES (1, 0, 0),
 (2, -360, 0),
 (3, 360, 0);
INSERT INTO component_size (id, width, height) VALUES (2,32,64),
 (3,32,64);
INSERT INTO component_velocity (id, x, y) VALUES (1,-1,0),
 (2,0,0),
 (3,0,0);
INSERT INTO component_radius (id, radius) VALUES (1,0);
INSERT INTO component_ball (id) VALUES (1);
INSERT INTO component_paddle (id) VALUES (2),
 (3);
INSERT INTO component_score (id, score) VALUES (2,0),
 (3,0);
COMMIT;
</sql><sql name="View: Velocity / Position">SELECT p.id, v.x AS vx, v.y AS vy, p.x AS px, p.y AS py FROM component_position AS p INNER JOIN component_velocity AS v ON p.id = v.id;</sql><sql name="View: Ball Position">SELECT b.id, p.x as px, p.y as py FROM component_ball as b INNER JOIN component_position as p WHERE b.id = p.id;</sql><sql name="System: Position Integrator">UPDATE component_position as p
SET x = px + vx,
    y = py + vy
FROM view_velocity_position as vp
where p.id = vp.id;

-- IF DEBUG
SELECT * from view_velocity_position;
-- ENDIF</sql><sql name="System: Ball Collision">UPDATE component_velocity as v
SET x = CASE
        WHEN (
            bp.x &lt; ?
            AND v.x &lt; 0
        )
        OR (
            bp.x &gt; ?
            AND v.x &gt; 0
        ) THEN - v.x
        ELSE v.x
    END,
    y = CASE
        WHEN (
            bp.y &lt; ?
            AND v.y &lt; 0
        )
        OR (
            bp.y &gt; ?
            AND v.y &gt; 0
        ) THEN - v.y
        ELSE v.y
    END
FROM view_ball_position AS bp
WHERE v.id = bp.id;

-- IF DEBUG
SELECT * from view_velocity_position;
-- ENDIF</sql><current_tab id="5"/></tab_sql></sqlb_project>
